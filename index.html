<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <title>Psych-Chat</title>
  <style>
    body{font-family:sans-serif;max-width:640px;margin:40px auto;padding:0 16px;}
    h1{font-size:1.8rem;text-align:center;}
    #messages{border:1px solid #ccc;height:400px;overflow-y:auto;padding:8px;}
    .user{color:#006;}
    .bot{color:#060;margin-bottom:12px;}
    #inputBar{display:flex;margin-top:8px;}
    #prompt{flex:1;padding:8px;font-size:1rem;}
    button{padding:8px 16px;font-size:1rem;}
  </style>
</head>
<body>
  <h1>ფსიქოლოგიური ჩატი</h1>

  <div id="messages"></div>

  <div id="inputBar">
    <input id="prompt" type="text" placeholder="კითხვა ფსიქოლოგს…" autocomplete="off">
    <button id="send">გაგზავნა</button>
  </div>

  <script>
    const messagesEl = document.getElementById('messages');
    const promptEl   = document.getElementById('prompt');
    const sendBtn    = document.getElementById('send');

    const chatHistory = [
      { role: 'system', content: 'თქვენ ხართ მხარდაჭერილი ფსიქოთერაპიული ჩატის ასისტენტი.' }
    ];

    function append(from, text){
      const div = document.createElement('div');
      div.className = from;
      div.textContent = (from === 'user' ? '👤: ' : '🤖: ') + text;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function send(){
      const text = promptEl.value.trim();
      if(!text) return;
      promptEl.value = '';
      append('user', text);
      chatHistory.push({ role:'user', content:text });

      try{
        const res = await fetch('/chat', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ messages: chatHistory })
        });
        const data = await res.json();
        append('bot', data.content);
        chatHistory.push({ role:'assistant', content:data.content });
      }catch(err){
        append('bot','[შეცდომა: სერვერთან კავშირი ვერ მოხერხდა]');
        console.error(err);
      }
    }

    sendBtn.onclick = send;
    promptEl.addEventListener('keydown', e => { if(e.key==='Enter') send(); });
  </script>
</body>
</html>
